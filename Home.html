<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitsmiles Comic Con Prize Wheel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* RESET & BASE */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
        height: 100%;
        width: 100%;
    }
    body {
      background: radial-gradient(circle, #ffffff, #f2f2f2);
      font-family: 'Montserrat', sans-serif; /* Default fallback */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px; /* Padding around the container */
      overflow: hidden; /* Prevent body scroll */
    }

    /* MAIN CONTAINER - Default (Mobile First) */
    .container {
      background: #F52F57; /* Radical Red */
      border-radius: 12px;
      padding: 30px 20px 40px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      max-width: 650px;
      width: 100%;
      height: auto; /* Height based on content */
      max-height: 95vh; /* Prevent excessive height on tall screens */
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.3s ease;
    }

    /* FULLSCREEN BUTTON */
    #fullscreen-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
        z-index: 20;
    }
    #fullscreen-btn:hover { background: rgba(255, 255, 255, 0.4); }
    #fullscreen-btn svg { width: 18px; height: 18px; fill: currentColor; }

    /* HEADER CONTENT WRAPPER */
    .header-content {
        width: 100%;
        text-align: center;
        margin-bottom: 20px;
        padding-top: 30px; /* Space for fullscreen button */
        transition: all 0.3s ease;
        flex-shrink: 0; /* Prevent header from shrinking too much */
    }

    /* WHEEL CONTENT WRAPPER */
    .wheel-content {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
        flex-grow: 1; /* Allow wheel content to grow */
        min-height: 0; /* Allow shrinking in flex container */
    }

    /* HEADER & LOGO */
    .logo { margin-bottom: 15px; line-height: 0; }
    .logo img { display: block; margin: 0 auto; max-height: 50px; width: auto; transition: max-height 0.3s ease; }
    h1 { font-family: 'Bebas Neue', cursive; font-size: 50px; color: #ffffff; margin-bottom: 10px; text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2); transition: font-size 0.3s ease; line-height: 1.1; }

    /* ARROW WRAPPER */
    .arrow-wrapper { text-align: center; margin-bottom: 10px; width: 100%; }
    .arrow { display: inline-block; width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 40px solid #ffffff; transform: rotate(180deg); transition: all 0.3s ease; }

    /* CANVAS CONTAINER & RESPONSIVE CANVAS */
    .canvas-container {
      width: 100%;
      max-width: 500px; /* Base max width */
      margin: 0 auto;
      transition: max-width 0.3s ease;
      flex-grow: 1; /* Allow container to take space */
      display: flex; /* Center canvas */
      align-items: center;
      justify-content: center;
      min-height: 0; /* Allow shrinking */
    }
    .wheel-wrapper { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    #canvas { display: block; border: 3px solid #ddd; border-radius: 50%; /* width/height set by JS */ }
    #canvas.spinning { animation: pulse 1s infinite alternate; }
    @keyframes pulse { from { opacity: 0.95; } to { opacity: 1; } }

    /* SPIN BUTTON */
    #spin { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background-color: transparent; border-radius: 50%; cursor: pointer; transition: all 0.15s ease; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; display: flex; align-items: center; justify-content: center; padding: 0; overflow: hidden; }
    #spin img { width: 100%; height: 100%; object-fit: cover; display: block; }
    #spin:hover { transform: translate(-50%, -50%) scale(1.05); }
    #spin:disabled { opacity: 0.6; cursor: not-allowed; }
    #spin.spinning { background-image: none; border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 4px solid #ffffff; width: 50px; height: 50px; animation: spin 1s linear infinite; background-color: transparent; }
    #spin.spinning img { display: none; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

    /* MODAL */
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.65); align-items: center; justify-content: center; }
    .modal-content { background-color: #fff; border-radius: 12px; padding: 30px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.3); max-width: 400px; width: 80%; position: relative; }
    .modal-content h2 { font-family: 'Bebas Neue', cursive; font-size: 44px; margin-bottom: 20px; color: #060606; }
    .modal-content p { font-size: 20px; color: #333; margin-bottom: 20px; }
    .close { position: absolute; right: 15px; top: 10px; font-size: 28px; font-weight: bold; color: #888; cursor: pointer; transition: color 0.3s ease; }
    .close:hover { color: #060606; }

    /* LANDSCAPE / WIDER SCREEN LAYOUT (Non-Fullscreen) */
    @media (min-width: 768px) and (min-height: 500px) {
        .container:not(body:fullscreen .container) { flex-direction: row; align-items: center; justify-content: space-around; padding: 40px; max-width: 1000px; height: auto; max-height: 90vh; }
        .header-content:not(body:fullscreen .header-content) { flex: 1 1 40%; padding-right: 30px; margin-bottom: 0; padding-top: 0; }
        .wheel-content:not(body:fullscreen .wheel-content) { flex: 1 1 60%; max-width: 50%; height: 100%; }
        .logo:not(body:fullscreen .logo) img { max-height: 60px; }
        h1:not(body:fullscreen h1) { font-size: 60px; }
        #spin:not(body:fullscreen #spin) { width: 100px; height: 100px; }
        #spin.spinning:not(body:fullscreen #spin.spinning) { width: 60px; height: 60px; }
        #fullscreen-btn:not(body:fullscreen #fullscreen-btn) { top: 20px; right: 20px; }
    }

    /* --- Styles specifically for FULLSCREEN --- */
    body:fullscreen .container { max-width: none; height: 100%; width: 100%; border-radius: 0; padding: 2vmin; flex-direction: row; justify-content: center; align-items: center; }
    body:fullscreen .header-content { padding: 0 2vmin; margin-bottom: 0; flex: 0 1 35%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 0; }
    body:fullscreen .wheel-content { flex: 1 1 65%; max-width: none; max-height: none; height: 100%; width: 100%; justify-content: center; }
    body:fullscreen .canvas-container { max-width: none; width: 100%; height: 100%; }
    body:fullscreen .logo img { max-height: 10vh; }
    body:fullscreen h1 { font-size: min(7vh, 70px); }
    body:fullscreen .arrow { border-left-width: 3vmin; border-right-width: 3vmin; border-bottom-width: 6vmin; }
    body:fullscreen #spin { width: clamp(80px, 18vmin, 120px); height: clamp(80px, 18vmin, 120px); }
    body:fullscreen #spin.spinning { width: clamp(50px, 12vmin, 80px); height: clamp(50px, 12vmin, 80px); }
    body:fullscreen #fullscreen-btn { top: 20px; right: 20px; }

  </style>
</head>
<body>
  <div class="container">
    <button id="fullscreen-btn" title="Toggle Fullscreen">
        </button>

    <div class="header-content">
      <div class="logo">
          <img src="fitsmile_logo.png" alt="Fitsmiles Logo"
               onerror="this.parentElement.innerHTML = '<div style=\'font-family: Bebas Neue, cursive; color: white; font-size: 48px;\'>FITSMILES</div>';">
      </div>
      <h1>Comic Con Prize Wheel</h1>
    </div>

    <div class="wheel-content">
      <div class="arrow-wrapper">
        <div class="arrow"></div>
      </div>
      <div class="canvas-container">
        <div class="wheel-wrapper">
          <canvas id="canvas"></canvas>
          <button id="spin">
            <img src="play_button.png"
                 alt="Spin the Wheel"
                 onerror="this.style.display='none'; this.parentElement.innerHTML += '<span style=\'font-size:12px; color: black;\'>Spin!</span>';" >
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close">&times;</span>
      <h2 id="modalHeader">Congratulations!</h2>
      <p id="winnerText"></p>
    </div>
  </div>

  <audio id="spinSound" src="spin-sound.mp3" preload="auto"></audio>
  <audio id="winSound" src="win-sound.mp3" preload="auto"></audio>

  <script>
    // --- Wheel Configuration ---
    const segments = [ "Pokémon Pack", "Try Again", "Keep Trying", "Pokémon Pack", "Keep Trying", "Try Again", "Pokémon Pack", "Keep Trying" ];
    const colors = [ "#060606", "#F52F57", "#060606", "#F52F57", "#060606", "#F52F57", "#060606", "#F52F57" ];
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let outsideRadius, insideRadius, textRadius, arc, startAngle = 0, displaySize;
    let spinTimeout = null, spinAngleStart = 10, spinTime = 0, spinTimeTotal = 0;
    const spinSound = document.getElementById("spinSound");
    const winSound = document.getElementById("winSound");
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const elem = document.documentElement;

    /* RESPONSIVE CANVAS SIZING & HiDPI SCALING */
    function updateCanvasSize() {
        const canvasContainer = document.querySelector(".canvas-container");
        if (!canvasContainer) { console.error("Canvas container not found!"); return; }
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
        let baseSize;
        const availableWidth = canvasContainer.clientWidth;
        const availableHeight = canvasContainer.clientHeight;

        if (availableWidth > 0 && availableHeight > 0) {
            if (isFullscreen) { baseSize = Math.min(availableWidth, availableHeight) * 0.95; }
            else { baseSize = Math.min(availableWidth, window.innerHeight * 0.7); }
        } else {
            baseSize = Math.min(window.innerWidth, window.innerHeight) * (isFullscreen ? 0.6 : 0.5);
            console.warn("Canvas container dimensions not available, using fallback size:", baseSize);
        }
        displaySize = Math.max(Math.floor(baseSize), 150);
        const dpr = window.devicePixelRatio || 1;
        canvas.width = displaySize * dpr;
        canvas.height = displaySize * dpr;
        canvas.style.width = displaySize + 'px';
        canvas.style.height = displaySize + 'px';
        outsideRadius = displaySize / 2 - (displaySize * 0.02);
        insideRadius = displaySize / 5;
        textRadius = outsideRadius * 0.75;
        arc = Math.PI * 2 / segments.length;
        // console.log("Updating canvas size. Display Size:", displaySize); // Debug log
        drawRouletteWheel(); // Draw after size update
    }

    /* Helper: Draw CURVED text along an arc */
    function drawCurvedText(ctx, text, centerX, centerY, radius, centralAngle, currentDisplaySize) {
        const fontSize = Math.max(10, Math.floor(currentDisplaySize / 35));
        ctx.font = `bold ${fontSize}px Montserrat`; // Font set here
        ctx.fillStyle = "#fff";
        ctx.textBaseline = "middle";
        const maxTextWidth = arc * radius * 0.8;
        let adjustedText = text;
        let textWidth = ctx.measureText(adjustedText).width;
        while (textWidth > maxTextWidth && adjustedText.length > 5) {
             adjustedText = adjustedText.slice(0, -4) + "...";
             textWidth = ctx.measureText(adjustedText).width;
        }
        if (radius <= 0) return;
        const totalTextAngle = textWidth / radius;
        let currentCharacterAngle = centralAngle - totalTextAngle / 2;
        for (let i = 0; i < adjustedText.length; i++) {
            const letter = adjustedText[i];
            const letterWidth = ctx.measureText(letter).width;
            const letterAngle = radius > 0 ? letterWidth / radius : 0;
            const angleForThisCharCenter = currentCharacterAngle + letterAngle / 2;
            const x = centerX + radius * Math.cos(angleForThisCharCenter);
            const y = centerY + radius * Math.sin(angleForThisCharCenter);
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angleForThisCharCenter + Math.PI / 2);
            ctx.textAlign = "center";
            ctx.fillText(letter, 0, 0);
            ctx.restore();
            currentCharacterAngle += letterAngle;
        }
    }

    /* DRAW THE PRIZE WHEEL */
    function drawRouletteWheel() {
      if (!displaySize || displaySize <= 0) { console.warn("displaySize invalid, skipping drawRouletteWheel"); return; }
      const dpr = window.devicePixelRatio || 1;
      const centerX = displaySize / 2;
      const centerY = displaySize / 2;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.scale(dpr, dpr);
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 2;
      for (let i = 0; i < segments.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = colors[i % colors.length];
        ctx.beginPath();
        ctx.arc(centerX, centerY, outsideRadius, angle, angle + arc, false);
        ctx.arc(centerX, centerY, insideRadius, angle + arc, angle, true);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        const midAngle = angle + arc / 2;
        drawCurvedText(ctx, segments[i], centerX, centerY, textRadius, midAngle, displaySize);
      }
      ctx.restore();
    }

    /* SPIN THE WHEEL ACTION */
    function spin() {
        document.getElementById("spin").disabled = true;
        document.getElementById("spin").classList.add("spinning");
        document.getElementById("canvas").classList.add("spinning");
        spinAngleStart = Math.random() * 10 + 10;
        spinTime = 0;
        spinTimeTotal = Math.random() * 3000 + 7000; // 7-10 seconds
        spinSound.loop = true;
        spinSound.play().catch(e => console.error("Audio play failed:", e));
        rotateWheel();
    }
    /* ROTATION ANIMATION LOOP */
    function rotateWheel() {
        spinTime += 30;
        if (spinTime >= spinTimeTotal) { stopRotateWheel(); return; }
        const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
        startAngle += (spinAngle * Math.PI / 180);
        drawRouletteWheel();
        spinTimeout = setTimeout(rotateWheel, 30);
    }
    /* STOP ROTATION AND DETERMINE WINNER */
    function stopRotateWheel() {
        clearTimeout(spinTimeout);
        spinSound.pause(); spinSound.currentTime = 0;
        const degrees = (startAngle * 180 / Math.PI) % 360;
        const arcDegrees = arc * 180 / Math.PI;
        const correctedDegrees = (360 - degrees + 270) % 360;
        const index = Math.floor(correctedDegrees / arcDegrees) % segments.length;
        const result = segments[index];
        if (result.toLowerCase() === "pokémon pack") {
            document.getElementById("modalHeader").innerText = "WINNER!";
            showModal("You won a Pokémon booster pack!");
            triggerConfetti();
            winSound.play().catch(e => console.error("Audio play failed:", e));
        } else {
            document.getElementById("modalHeader").innerText = "KEEP TRYING!";
            showModal("You only fail when you give up!");
        }
        setTimeout(() => {
            document.getElementById("spin").disabled = false;
            document.getElementById("spin").classList.remove("spinning");
            document.getElementById("canvas").classList.remove("spinning");
        }, 500);
    }
    /* Easing function */
    function easeOut(t, b, c, d) { const ts = (t/=d)*t; const tc = ts*t; return b+c*(tc + -3*ts + 3*t); }
    /* Modal Functions */
    function showModal(message) { document.getElementById("winnerText").innerText = message; document.getElementById("modal").style.display = "flex"; }
    function closeModal() { document.getElementById("modal").style.display = "none"; }
    /* Confetti Function */
    function triggerConfetti() {
        const duration = 3 * 1000, animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 101 };
        function randomInRange(min, max) { return Math.random() * (max - min) + min; }
        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) { return clearInterval(interval); }
            const particleCount = 50 * (timeLeft / duration);
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }, colors: ['#F52F57', '#FFC107', '#2196F3', '#4CAF50', '#ffffff'] });
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }, colors: ['#F52F57', '#FFC107', '#2196F3', '#4CAF50', '#ffffff'] });
        }, 250);
     }

    // --- Fullscreen API Logic ---
    const enterFullscreenIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5M.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5"/></svg>`;
    const exitFullscreenIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5m5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5M0 10.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 0-1m10.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5z"/></svg>`;

    function updateFullscreenButton() {
        // console.log("Updating fullscreen button state..."); // Debug log
        if (!fullscreenBtn) { /*console.log(" - Button not found");*/ return; }
        const isCurrentlyFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
        // console.log(" - Is fullscreen?", !!isCurrentlyFullscreen); // Debug log
        if (isCurrentlyFullscreen) {
            fullscreenBtn.innerHTML = exitFullscreenIcon;
            fullscreenBtn.title = "Exit Fullscreen";
        } else {
            fullscreenBtn.innerHTML = enterFullscreenIcon;
            fullscreenBtn.title = "Enter Fullscreen";
        }
    }

    function toggleFullScreen() {
        // console.log("Toggle fullscreen called..."); // Debug log
        const fsEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled;
        if (!fsEnabled) { console.warn("Fullscreen API is not supported or enabled."); return; }

        const currentFsElement = document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
        // console.log(" - Currently fullscreen?", !!currentFsElement); // Debug log

        if (!currentFsElement) {
            // console.log(" - Requesting fullscreen..."); // Debug log
            if (elem.requestFullscreen) { elem.requestFullscreen().catch(err => { console.error(`FS Error: ${err.message} (${err.name})`); }); }
            else if (elem.webkitRequestFullscreen) { elem.webkitRequestFullscreen(); }
            else if (elem.msRequestFullscreen) { elem.msRequestFullscreen(); }
        } else {
            // console.log(" - Exiting fullscreen..."); // Debug log
            if (document.exitFullscreen) { document.exitFullscreen().catch(err => { console.error(`Exit FS Error: ${err.message} (${err.name})`); }); }
            else if (document.webkitExitFullscreen) { document.webkitExitFullscreen(); }
            else if (document.msExitFullscreen) { document.msExitFullscreen(); }
        }
    }


    // --- App Initialization ---
    function initializeApp() {
        // console.log("Initializing App..."); // Debug log
        updateCanvasSize(); // Initial draw
        // Initial button state is set via DOMContentLoaded below
    }

    // --- Event Listeners Setup ---
    function setupEventListeners() {
        // console.log("Setting up event listeners..."); // Debug log
        const spinBtn = document.getElementById("spin");
        const closeBtn = document.getElementById("close");
        const modalEl = document.getElementById("modal");

        if (spinBtn) spinBtn.addEventListener("click", spin); else console.error("Spin button not found");
        if (closeBtn) closeBtn.addEventListener("click", closeModal); else console.error("Close button not found");
        if (modalEl) window.addEventListener("click", function(event) { if (event.target === modalEl) { closeModal(); } }); else console.error("Modal element not found");


        // Debounce resize/fullscreen updates
        let resizeTimeout;
        function debouncedUpdate() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(updateCanvasSize, 150);
        }
        window.addEventListener("resize", debouncedUpdate);
        document.addEventListener('fullscreenchange', debouncedUpdate);
        document.addEventListener('webkitfullscreenchange', debouncedUpdate);
        document.addEventListener('msfullscreenchange', debouncedUpdate);

        // Fullscreen Button Setup
        if (fullscreenBtn) {
            const fsEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled;
            if (fsEnabled) {
                // console.log(" - Setting up fullscreen button listener."); // Debug log
                fullscreenBtn.addEventListener('click', toggleFullScreen);
                // Listen for fullscreen changes to update button icon
                document.addEventListener('fullscreenchange', updateFullscreenButton);
                document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
                document.addEventListener('msfullscreenchange', updateFullscreenButton);
            } else {
                fullscreenBtn.style.display = 'none';
                console.warn("Fullscreen API is not supported by this browser.");
            }
        } else {
             console.error("Fullscreen button element not found during listener setup.");
        }
    }


    // --- Start the App ---

    // 1. Setup listeners that don't depend on fonts first
    setupEventListeners();

    // 2. Set initial fullscreen button state once DOM is ready
    // Ensure this runs even if fonts.ready fires first
    function setInitialButtonState() {
        // console.log("DOM ready, setting initial button state."); // Debug log
         if (fullscreenBtn) {
             updateFullscreenButton(); // Set initial icon
         } else {
             // If button isn't found here, there's an issue
             console.error("Fullscreen button not found on DOMContentLoaded!");
         }
    }
    if (document.readyState === 'loading') { // Loading hasn't finished yet
        document.addEventListener('DOMContentLoaded', setInitialButtonState);
    } else { // `DOMContentLoaded` has already fired
        setInitialButtonState();
    }


    // 3. Wait for fonts then perform initial draw
    document.fonts.ready.then(() => {
        // console.log("Fonts ready, performing initial draw."); // Debug log
        initializeApp(); // Contains updateCanvasSize -> drawRouletteWheel
    }).catch(error => {
        console.error("Font loading failed or timed out:", error);
        initializeApp(); // Initialize anyway
    });

  </script>
</body>
</html>
