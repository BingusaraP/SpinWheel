<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitsmiles Comic Con Prize Wheel</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* RESET & BASE */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
        height: 100%; /* Ensure body takes full height for fullscreen */
        width: 100%;
    }
    body {
      background: radial-gradient(circle, #ffffff, #f2f2f2);
      font-family: 'Montserrat', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      overflow-x: hidden; /* Prevent horizontal scroll */
    }

    /* MAIN CONTAINER - Default (Mobile First) */
    .container {
      background: #F52F57; /* Radical Red */
      border-radius: 12px;
      padding: 30px 20px 40px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      max-width: 650px; /* Max width for mobile */
      width: 100%;
      position: relative; /* Needed for absolute positioning of fullscreen button */
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* FULLSCREEN BUTTON */
    #fullscreen-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.2); /* Semi-transparent white */
        border: none;
        color: white;
        padding: 8px;
        border-radius: 50%; /* Make it circular */
        cursor: pointer;
        width: 36px; /* Fixed size */
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
        z-index: 20; /* Above other elements */
    }
    #fullscreen-btn:hover {
        background: rgba(255, 255, 255, 0.4);
    }
    #fullscreen-btn svg {
        width: 18px; /* Icon size */
        height: 18px;
        fill: currentColor;
    }

    /* HEADER CONTENT WRAPPER */
    .header-content {
        width: 100%;
        text-align: center;
        margin-bottom: 20px;
        padding-top: 30px; /* Add padding to avoid overlap with fullscreen button */
    }

    /* WHEEL CONTENT WRAPPER */
    .wheel-content {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* HEADER & LOGO */
    .logo {
      /* Removed font styles */
      margin-bottom: 15px; /* Increased margin below logo */
      line-height: 0; /* Prevent extra space around image */
    }
    .logo img {
        display: block; /* Helps remove extra space */
        margin: 0 auto; /* Center the image */
        max-height: 50px; /* Control logo height */
        width: auto; /* Maintain aspect ratio */
    }
    h1 {
      font-family: 'Bebas Neue', cursive;
      font-size: 50px;
      color: #ffffff;
      margin-bottom: 10px;
      text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
    }

    /* ARROW WRAPPER */
    .arrow-wrapper {
      text-align: center;
      margin-bottom: 10px;
      width: 100%;
    }
    /* DOWNWARD-FACING ARROW */
    .arrow {
      display: inline-block;
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 40px solid #ffffff;
      transform: rotate(180deg);
    }

    /* CANVAS CONTAINER & RESPONSIVE CANVAS */
    .canvas-container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
    .wheel-wrapper {
      position: relative;
      width: 100%;
    }
    #canvas {
      display: block;
      width: 100%;
      height: auto;
      border: 3px solid #ddd;
      border-radius: 50%;
    }
    #canvas.spinning {
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      from { opacity: 0.95; }
      to { opacity: 1; }
    }

    /* SPIN BUTTON */
    #spin {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background-color: transparent;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.15s ease;
      border: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      overflow: hidden;
    }
    #spin img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    #spin:hover {
      transform: translate(-50%, -50%) scale(1.05);
    }
    #spin:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #spin.spinning {
      background-image: none;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #ffffff;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      background-color: transparent;
    }
    #spin.spinning img {
      display: none;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.65);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #fff;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 80%;
      position: relative;
    }
    .modal-content h2 {
      font-family: 'Bebas Neue', cursive;
      font-size: 44px;
      margin-bottom: 20px;
      color: #060606;
    }
    .modal-content p {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
    }
    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 28px;
      font-weight: bold;
      color: #888;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .close:hover {
      color: #060606;
    }

    /* LANDSCAPE / WIDER SCREEN LAYOUT */
    @media (min-width: 768px) {
        .container {
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
            padding: 40px;
            max-width: 1000px;
        }
        .header-content {
            flex: 1;
            text-align: center;
            padding-right: 30px;
            margin-bottom: 0;
            padding-top: 0; /* Reset padding */
        }
        .wheel-content {
            flex: 1.5;
            max-width: 50%;
        }
        .logo img {
             max-height: 60px; /* Adjust logo height for landscape */
        }
        h1 { font-size: 60px; }

        #spin {
             width: 100px;
             height: 100px;
        }
        #spin.spinning {
             width: 60px;
             height: 60px;
        }
        #fullscreen-btn { /* Adjust position slightly for landscape */
            top: 20px;
            right: 20px;
        }
    }

    /* Styles when fullscreen */
    body:fullscreen .container {
        max-width: none; /* Allow container to fill screen */
        height: 100%;
        width: 100%;
        border-radius: 0; /* Remove border radius in fullscreen */
        padding: 20px; /* Adjust padding */
        justify-content: center; /* Center content vertically */
    }
    body:fullscreen .header-content {
        padding-top: 0; /* Remove extra padding */
    }
    body:fullscreen #fullscreen-btn {
        /* Optionally reposition or style differently in fullscreen */
        top: 20px;
        right: 20px;
    }


  </style>
</head>
<body>
  <div class="container">
    <button id="fullscreen-btn" title="Toggle Fullscreen">
        </button>

    <div class="header-content">
      <div class="logo">
          <img src="fitsmile_logo.png" alt="Fitsmiles Logo"
               onerror="this.parentElement.innerHTML = '<div style=\'font-family: Bebas Neue, cursive; color: white; font-size: 48px;\'>FITSMILES</div>';">
               </div>
      <h1>Comic Con Prize Wheel</h1>
    </div>

    <div class="wheel-content">
      <div class="arrow-wrapper">
        <div class="arrow"></div>
      </div>
      <div class="canvas-container">
        <div class="wheel-wrapper">
          <canvas id="canvas"></canvas>
          <button id="spin">
            <img src="play_button.png"
                 alt="Spin the Wheel"
                 onerror="this.style.display='none'; this.parentElement.innerHTML += '<span style=\'font-size:12px; color: black;\'>Spin!</span>';" >
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close">&times;</span>
      <h2 id="modalHeader">Congratulations!</h2>
      <p id="winnerText"></p>
    </div>
  </div>

  <audio id="spinSound" src="spin-sound.mp3" preload="auto"></audio>
  <audio id="winSound" src="win-sound.mp3" preload="auto"></audio>

  <script>
    // --- Existing Wheel Code ---
    const segments = [
      "Pokémon Pack", "Try Again", "Keep Trying",
      "Pokémon Pack", "Keep Trying", "Try Again",
      "Pokémon Pack", "Keep Trying"
    ];
    const colors = [
      "#060606", "#F52F57", "#060606", "#F52F57",
      "#060606", "#F52F57", "#060606", "#F52F57"
    ];
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let outsideRadius, insideRadius, textRadius, arc, startAngle = 0;
    let spinTimeout = null;
    let spinAngleStart = 10;
    let spinTime = 0;
    let spinTimeTotal = 0;
    const spinSound = document.getElementById("spinSound");
    const winSound = document.getElementById("winSound");

    function updateCanvasSize() {
      const wheelWrapper = document.querySelector(".wheel-wrapper");
      // Use clientWidth for size calculation within fullscreen/flexbox
      const size = Math.min(wheelWrapper.clientWidth, window.innerHeight * 0.7); // Limit height influence
      canvas.width = size;
      canvas.height = size;
      outsideRadius = size / 2 - 10;
      insideRadius = size / 5;
      textRadius = outsideRadius * 0.75;
      arc = Math.PI * 2 / segments.length;
      drawRouletteWheel();
    }

    function drawCurvedText(ctx, text, centerX, centerY, radius, centralAngle) {
        const fontSize = Math.max(10, Math.floor(canvas.width / 30));
        ctx.font = `bold ${fontSize}px Montserrat`;
        ctx.fillStyle = "#fff";
        ctx.textBaseline = "middle";
        const textWidth = ctx.measureText(text).width;
        // Add check for radius to prevent division by zero or NaN angles
        if (radius <= 0) return;
        const totalTextAngle = textWidth / radius;
        let currentCharacterAngle = centralAngle - totalTextAngle / 2;
        for (let i = 0; i < text.length; i++) {
            const letter = text[i];
            const letterWidth = ctx.measureText(letter).width;
            const letterAngle = letterWidth / radius;
            const angleForThisCharCenter = currentCharacterAngle + letterAngle / 2;
            const x = centerX + radius * Math.cos(angleForThisCharCenter);
            const y = centerY + radius * Math.sin(angleForThisCharCenter);
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angleForThisCharCenter + Math.PI / 2);
            ctx.textAlign = "center";
            ctx.fillText(letter, 0, 0);
            ctx.restore();
            currentCharacterAngle += letterAngle;
        }
    }

    function drawRouletteWheel() {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 2;
      for (let i = 0; i < segments.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = colors[i % colors.length];
        ctx.beginPath();
        ctx.arc(centerX, centerY, outsideRadius, angle, angle + arc, false);
        ctx.arc(centerX, centerY, insideRadius, angle + arc, angle, true);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        const midAngle = angle + arc / 2;
        drawCurvedText(ctx, segments[i], centerX, centerY, textRadius, midAngle);
      }
    }

    function spin() {
      document.getElementById("spin").disabled = true;
      document.getElementById("spin").classList.add("spinning");
      document.getElementById("canvas").classList.add("spinning");
      spinAngleStart = Math.random() * 10 + 10;
      spinTime = 0;
      spinTimeTotal = Math.random() * 3000 + 7000;
      spinSound.loop = true;
      spinSound.play().catch(e => console.error("Audio play failed:", e));
      rotateWheel();
    }

    function rotateWheel() {
      spinTime += 30;
      if (spinTime >= spinTimeTotal) {
        stopRotateWheel();
        return;
      }
      const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
      startAngle += (spinAngle * Math.PI / 180);
      drawRouletteWheel();
      spinTimeout = setTimeout(rotateWheel, 30);
    }

    function stopRotateWheel() {
      clearTimeout(spinTimeout);
      spinSound.pause();
      spinSound.currentTime = 0;
      const degrees = (startAngle * 180 / Math.PI) % 360;
      const arcDegrees = arc * 180 / Math.PI;
      const correctedDegrees = (360 - degrees + 270) % 360;
      const index = Math.floor(correctedDegrees / arcDegrees) % segments.length;
      const result = segments[index];
      if (result.toLowerCase() === "pokémon pack") {
        document.getElementById("modalHeader").innerText = "WINNER!";
        showModal("You won a Pokémon booster pack!");
        triggerConfetti();
        winSound.play().catch(e => console.error("Audio play failed:", e));
      } else {
        document.getElementById("modalHeader").innerText = "KEEP TRYING!";
        showModal("You only fail when you give up!");
      }
      setTimeout(() => {
          document.getElementById("spin").disabled = false;
          document.getElementById("spin").classList.remove("spinning");
          document.getElementById("canvas").classList.remove("spinning");
      }, 500);
    }

    function easeOut(t, b, c, d) {
      const ts = (t /= d) * t;
      const tc = ts * t;
      return b + c * (tc + -3 * ts + 3 * t);
    }

    function showModal(message) {
      document.getElementById("winnerText").innerText = message;
      document.getElementById("modal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("modal").style.display = "none";
    }

    function triggerConfetti() {
        const duration = 3 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 101 };
        function randomInRange(min, max) { return Math.random() * (max - min) + min; }
        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) { return clearInterval(interval); }
            const particleCount = 50 * (timeLeft / duration);
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }, colors: ['#F52F57', '#FFC107', '#2196F3', '#4CAF50', '#ffffff'] });
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }, colors: ['#F52F57', '#FFC107', '#2196F3', '#4CAF50', '#ffffff'] });
        }, 250);
    }

    // --- Fullscreen API Logic ---
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const elem = document.documentElement; // Element to make fullscreen (whole page)

    // SVG Icons for button states
    const enterFullscreenIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5M.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5"/></svg>`;
    const exitFullscreenIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5m5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5M0 10.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 0-1m10.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5z"/></svg>`;

    // Function to update button icon based on fullscreen state
    function updateFullscreenButton() {
        if (!fullscreenBtn) return; // Check if button exists
        if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) { // Check across prefixes
            fullscreenBtn.innerHTML = exitFullscreenIcon;
            fullscreenBtn.title = "Exit Fullscreen";
        } else {
            fullscreenBtn.innerHTML = enterFullscreenIcon;
            fullscreenBtn.title = "Enter Fullscreen";
        }
    }

    // Function to toggle fullscreen mode
    function toggleFullScreen() {
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) { // Check across prefixes
            // Try to enter fullscreen mode
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    // alert(`Could not enter fullscreen mode: ${err.message}`); // Avoid alert blocking UI
                });
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
        } else {
            // Exit fullscreen mode
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) { /* Safari */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE11 */
                document.msExitFullscreen();
            }
        }
    }

    // Event listener for the button
    if (fullscreenBtn) {
        // Check if Fullscreen API is supported at all
        const fsEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled;
        if (fsEnabled) {
            fullscreenBtn.addEventListener('click', toggleFullScreen);
            // Update button initially
            updateFullscreenButton();
            // Listen for fullscreen changes (e.g., user pressing Esc)
            document.addEventListener('fullscreenchange', updateFullscreenButton);
            document.addEventListener('webkitfullscreenchange', updateFullscreenButton); // Safari
            document.addEventListener('msfullscreenchange', updateFullscreenButton); // IE11
        } else {
            // Hide button if fullscreen is not supported
            fullscreenBtn.style.display = 'none';
            console.warn("Fullscreen API is not supported by this browser.");
        }
    } else {
        console.error("Fullscreen button not found");
    }


    // --- Event Listeners & Initial Setup ---
    document.getElementById("spin").addEventListener("click", spin);
    document.getElementById("close").addEventListener("click", closeModal);
    window.addEventListener("click", function(event) {
      if (event.target === document.getElementById("modal")) {
        closeModal();
      }
    });
    // Update canvas size on resize and also when entering/exiting fullscreen
    window.addEventListener("resize", updateCanvasSize);
    document.addEventListener('fullscreenchange', updateCanvasSize);
    document.addEventListener('webkitfullscreenchange', updateCanvasSize); // Safari
    document.addEventListener('msfullscreenchange', updateCanvasSize); // IE11

    /* INITIAL SETUP */
    updateCanvasSize(); // Draw the wheel initially

  </script>
</body>
</html>
